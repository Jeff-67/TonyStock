# Instructions

During interaction with the user, if you find anything reusable in this project (e.g. version of a library, model name), especially about a fix to a mistake you made or a correction you received, you should take note in the `Lessons` section in the `.cursorrules` file so you will not make the same mistake again.

You should also use the `.cursorrules` file as a scratchpad to organize your thoughts. When receiving a new task:
1. Review the scratchpad content
2. Clear old different task if necessary
3. Explain the new task
4. Plan the steps needed to complete the task
5. Use todo markers to track progress: [X] Done, [ ] Pending
6. Update progress when subtasks are completed

# Tools Configuration

1. Environment Setup
   - Activate conda environment 'stock' before running tools
   - Use run_terminal_cmd for executing Python scripts
   - Set appropriate timeout values for web scraping

2. Data Collection & Analysis Tools
   a. search_engine.py
      - Command: conda activate stock && python -m tools.search_engine "search query" [--max-results N]
      - Quote multi-word queries
      - Default max results: 10
      - Uses DuckDuckGo with API/HTML fallback
      - Debug logging included
      - Returns URLs that should be passed to web_scraper.py for full content

   b. web_scraper.py
      - Command: conda activate stock && python -m tools.web_scraper [URLs...] [--max-concurrent N] [--debug]
      - Used after search_engine.py to get full content from URLs
      - URLs must be complete (with http:// or https://)
      - Quote URLs with special characters
      - Default max concurrent: 5
      - Timeout: 30s with auto-retry
      - Debug flag available

   c. read_pdf.py
      - Command: conda activate stock && python -m tools.read_pdf [pdf_path] [--model model_name]
      - Default model: gpt-4o
      - Outputs markdown in same directory

   d. llm_api.py
      - Supports OpenAI, Anthropic, and local models
      - Default models:
        * OpenAI: gpt-4o
        * Anthropic: claude-3-sonnet-20240229
        * Local: Qwen/Qwen2.5-32B-Instruct-AWQ

   e. market_data_fetcher.py
      - Command: conda activate stock && python -m tools.market_data_fetcher [symbols...] [options]
      - Features:
        * Fetches historical price and volume data
        * Supports multiple symbols
        * Flexible time intervals (1d, 1wk, 1mo)
        * Customizable date range
      - Options:
        * --interval: Data interval (1d, 1wk, 1mo)
        * --days: Number of days of historical data
        * --output/-o: Output file path
        * --format: Output format (json, csv)
        * --debug: Enable debug logging
      - Example:
        ```bash
        python -m tools.market_data_fetcher AAPL MSFT --interval 1d --days 30 --format csv
        ```

   f. financial_data_fetcher.py
      - Command: conda activate stock && python -m tools.financial_data_fetcher [symbols...] [options]
      - Features:
        * Fetches financial statements
        * Supports multiple symbols
        * Income statement, balance sheet, cash flow
        * Standardized data formatting
      - Options:
        * --statements: Statements to fetch (income, balance, cash)
        * --output/-o: Output file path
        * --format: Output format (json, csv)
        * --debug: Enable debug logging
      - Example:
        ```bash
        python -m tools.financial_data_fetcher AAPL --statements income balance --format json
        ```

# Typical News Collection Workflow
1. Use search_engine.py to find relevant news articles
   - Craft search queries based on News Collection Strategy
   - Use quotes for exact phrases
   - Consider time period relevance

2. Use web_scraper.py to get full content
   - Pass URLs from search results directly
   - Use --max-concurrent for efficiency
   - Enable --debug for troubleshooting

3. Analyze content using frameworks
   - Apply relevant analysis frameworks
   - Cross-validate information
   - Document sources and findings

# Analysis Frameworks

1. Financial Analysis
   - Revenue trends (MoM, YoY)
   - Profitability metrics
   - Cash flow indicators
   - Growth rates
   - Efficiency ratios

2. Industry Analysis
   - Market size & growth
   - Competitive landscape
   - Value chain position
   - Entry barriers
   - Technology trends

3. Company Analysis
   - Business model
   - Product portfolio
   - Customer base
   - R&D capabilities
   - Management team

4. Risk Assessment
   - Operational risks
   - Financial risks
   - Market risks
   - Regulatory risks
   - Strategic risks

# News Collection Strategy

1. Supply Chain Analysis
   - Upstream suppliers and their dynamics
   - Downstream customers and demand trends
   - Key partnerships and strategic alliances
   - Supply chain disruptions and mitigation
   - Pricing power in the value chain

2. Industry Ecosystem
   - Competitive positioning changes
   - New entrants and their impact
   - Technology shifts and adoption
   - Regulatory changes and compliance
   - Industry consolidation trends

3. Market Dynamics
   - End-market demand changes
   - Geographic market expansion
   - Product mix evolution
   - Pricing trends and pressures
   - Market share movements

4. Strategic Initiatives
   - R&D developments and breakthroughs
   - M&A activities and integration
   - Capacity expansion plans
   - New product launches
   - Strategic partnerships

5. External Factors
   - Government policies and regulations
   - Economic indicators and impact
   - Technology disruption
   - Geopolitical factors
   - Environmental considerations

# Best Practices

1. Data Collection
   - Cross-validate multiple sources
   - Prioritize official announcements
   - Verify data timeliness
   - Document sources clearly

2. Analysis Process
   - Start with key findings
   - Use clear metrics
   - Support claims with data
   - Consider multiple scenarios
   - Update regularly

3. Report Writing
   - Clear executive summary
   - Structured sections
   - Data visualization
   - Risk disclosure
   - Actionable insights

4. Investment Recommendations
   - Short-term (6-12 months)
   - Medium-term (1-2 years)
   - Long-term (2+ years)
   - Clear entry/exit points
   - Risk mitigation strategies

5. Stock Analysis Best Practices
   - Information Hierarchy
     * Start with basic news for overall direction
     * Deep dive into technical/project details
     * Include market perspectives (e.g., foreign institutions)

   - Time Sensitivity
     * Always check news publication dates
     * Differentiate historical data from latest updates
     * Avoid outdated predictions/outlooks

   - Specificity
     * Use concrete numbers instead of vague descriptions
     * Include technical specifications when relevant
     * Provide exact project timelines and milestones

   - Multi-source Verification
     * Company statements (earnings calls)
     * Analyst reports
     * Industry news
     * Cross-reference multiple sources

   - Source Citation
     * Cite every major point
     * Include media name and article title
     * Enable readers to verify information

# Required Analysis Steps

1. 資料收集
   - 使用 search_engine.py 搜尋最新新聞
   - 使用 web_scraper.py 獲取完整內容
   - 使用 market_data_fetcher.py 取得市場數據
   - 使用 financial_data_fetcher.py 取得財務數據
   - 交叉驗證多個來源

2. 數據分析
   - 整理新聞重點
   - 分析財務數據趨勢
   - 比較同業表現
   - 檢視技術面變化
   - 評估風險因素

3. 結論產出
   - 依據分析框架撰寫
   - 提供具體數據支持
   - 清楚列出優劣勢
   - 給出明確建議
   - 設定監控指標

# Stock Analysis Framework

## General Workflow
1. Initial Setup
   - Create stock-specific instruction file in `prompts/{stock_id}_instruction.md`
   - Define search keywords and analysis framework
   - Set up news monitoring parameters

2. Information Collection
   - Search latest news using defined keywords
   - Prioritize news sources based on reliability
   - Cross-validate information from multiple sources
   - Track time sensitivity of information

3. Analysis Process
   - Follow time-based organization
   - Apply layered analysis framework
   - Cross-reference with industry trends
   - Update stock-specific instruction file if needed

4. Report Generation
   - Clear timestamp for each piece of information
   - Proper source citation
   - Layered impact analysis
   - Risk assessment

## News Collection Strategy
1. Source Priority
   - Company announcements
   - Major financial media
   - Industry reports
   - Market analysis

2. Time Sensitivity
   - Immediate (24h)
   - Recent (7 days)
   - Mid-term (1 month)
   - Long-term (1+ month)

3. Cross-validation
   - Multiple sources
   - Different perspectives
   - Time consistency
   - Fact checking

## Analysis Framework
1. Direct Information
   - Financial data
   - Operational updates
   - Company announcements
   - Market response

2. Industry Chain
   - Upstream suppliers
   - Downstream customers
   - Competitive landscape
   - Market positioning

3. Macro Environment
   - Industry trends
   - Technology development
   - Geopolitical factors
   - Economic indicators

4. Risk Assessment
   - Operational risks
   - Financial risks
   - Market risks
   - Strategic risks

## Documentation Rules
1. Stock-specific Instructions
   - Create in prompts/{stock_id}_instruction.md
   - Include specific search keywords
   - Define unique analysis points
   - Update as needed

2. Information Organization
   - Clear timestamps
   - Source attribution
   - Impact assessment
   - Risk highlights

3. Update Frequency
   - Real-time for critical news
   - Daily for market updates
   - Weekly for trend analysis
   - Monthly for strategy review

## Lessons Learned
1. News Analysis
   - Always check news timestamps
   - Cross-validate important information
   - Consider source reliability
   - Track information updates

2. Framework Updates
   - Keep stock-specific instructions current
   - Refine search keywords based on results
   - Adjust analysis framework as needed
   - Document successful patterns

# Lessons Learned

1. Tool Usage
   - Always activate conda environment 'stock' before running tools (CRITICAL)
   - Handle timeouts and retries properly
   - Use correct character encoding
   - Follow proper file paths
   - Document API keys securely
   - Python Package Structure (Added 2024/01):
     * Always run scripts as modules from project root: `python -m tools.script_name`
     * Ensure `__init__.py` exists in all package directories
     * Don't run Python scripts directly from their containing directory
     * Example: Use `python -m tools.market_data_fetcher` instead of `python tools/market_data_fetcher.py`

2. Data Validation
   - Verify company identifiers
   - Cross-check market data
   - Validate historical trends
   - Monitor data freshness
   - Track source reliability

3. Analysis Improvements
   - Focus on quantifiable metrics
   - Consider industry context
   - Track leading indicators
   - Monitor competitive dynamics
   - Update assumptions regularly

4. Report Quality
   - Clear data visualization
   - Consistent terminology
   - Proper source citation
   - Regular updates
   - Actionable recommendations

5. Stock Analysis Best Practices
   - Information Hierarchy
     * Start with basic news for overall direction
     * Deep dive into technical/project details
     * Include market perspectives (e.g., foreign institutions)

   - Time Sensitivity
     * Always check news publication dates
     * Differentiate historical data from latest updates
     * Avoid outdated predictions/outlooks

   - Specificity
     * Use concrete numbers instead of vague descriptions
     * Include technical specifications when relevant
     * Provide exact project timelines and milestones

   - Multi-source Verification
     * Company statements (earnings calls)
     * Analyst reports
     * Industry news
     * Cross-reference multiple sources

   - Source Citation
     * Cite every major point
     * Include media name and article title
     * Enable readers to verify information

6. New Lessons from Recent Analysis (2024/01)
   - Data Organization
     * Present financial data in clear, structured format (e.g., using code blocks for numbers)
     * Group related metrics together (revenue, profit, growth rates)
     * Show year-over-year or quarter-over-quarter comparisons

   - Reference Management
     * Always include source URLs for key data points
     * Organize references by topic/category
     * Include publication dates for time-sensitive information

   - Analysis Structure
     * Start with high-level overview
     * Break down into specific components
     * Support each point with concrete data
     * Conclude with actionable insights

   - Risk Assessment
     * Consider both immediate and long-term impacts
     * Track policy changes and their effects
     * Monitor leading indicators (e.g., customer traffic, order rates)
     * Compare with industry trends

7. Financial Data Fetching (2024/03)
   - Data Reliability
     * Always check for empty dataframes before processing
     * Verify data consistency across different time periods
     * Handle missing values appropriately
     * Cross-validate critical financial metrics

   - Performance Optimization
     * Use appropriate time intervals for market data
     * Cache frequently accessed data
     * Implement rate limiting for API calls
     * Handle concurrent requests efficiently

   - Error Management
     * Log all API errors with context
     * Implement graceful fallbacks
     * Monitor rate limits
     * Track data quality issues

8. Stock Analysis Best Practices (Updated 2025/01)
   - Reference Management
     * ALWAYS cite sources for every major analysis point
     * Include publication date with each reference
     * Format: [Source Name, Date, "Article Title"]
     * Organize references by topic/category

   - Analysis Structure
     * Start with company fundamentals
     * Expand to industry chain analysis
     * Connect with macro environment
     * Support each point with concrete data

   - Information Depth
     * Don't stop at first layer of news
     * Search for related industry trends
     * Look for customer/supplier dynamics
     * Cross-reference multiple perspectives

   - Context Building
     * Link company performance with industry cycles
     * Connect customer plans with company outlook
     * Consider competitive landscape
     * Track policy and regulation impacts

9. Stock Analysis Best Practices (Updated 2025/01)
   - Comprehensive Framework Application
     * Follow structured analysis framework strictly
     * Start with industry analysis before company specifics
     * Connect market trends with company strategy
     * Analyze sustainability initiatives in detail

   - Data Integration
     * Combine financial metrics with strategic initiatives
     * Cross-reference market data with company announcements
     * Track transformation progress with concrete metrics
     * Monitor market share changes across regions

   - Sustainability Focus
     * Track specific environmental initiatives and their impact
     * Quantify emissions reduction achievements
     * Monitor compliance with international standards
     * Analyze green product development and adoption

   - Strategic Transformation Analysis
     * Document revenue mix changes
     * Track market share in different regions
     * Monitor progress in new business areas
     * Analyze impact on financial metrics

10. Research Methodology (Added 2025/01)
    - Sequential Information Gathering
      * Start with recent market data
      * Follow up with news and announcements
      * Deep dive into strategic initiatives
      * Cross-validate information from multiple sources

    - Tool Usage Optimization
      * Use market_data_fetcher for quantitative analysis
      * Leverage search_engine for recent developments
      * Apply web_scraper for detailed news content
      * Combine tools for comprehensive analysis

11. Supply Chain Analysis Best Practices (Added 2025/01)
    - Supply Chain Verification
      * Always verify exact timing of supply chain participation
      * Cross-check multiple sources for supply chain relationships
      * Differentiate between rumored and confirmed supplier status
      * Track the evolution of supplier relationships over time

    - Timeline Accuracy
      * Document when a company enters a supply chain
      * Note any changes in supplier tier status
      * Track product generations and participation
      * Verify historical supply relationships

    - Information Quality
      * Prioritize official announcements and certifications
      * Be cautious with market rumors and speculation
      * Distinguish between different product generations
      * Document the source and timing of supply chain information

12. Web Scraping Best Practices (Added 2025/01)
    - Timeout Settings
      * Use shorter timeout (30s instead of 60s)
      * Add retry mechanism with shorter delays
      * Monitor and log timeout issues
      * Implement graceful fallbacks

    - URL Handling
      * Verify URL encoding before scraping
      * Test with simpler URLs first
      * Handle different news site formats
      * Validate URL accessibility

    - Content Extraction
      * Focus on essential content
      * Remove unnecessary JavaScript execution
      * Optimize page load strategy
      * Improve error handling and logging

13. News Analysis Framework (Added 2025/01)
    - Systematic Approach
      * Gather news from multiple sources
      * Cross-validate key information
      * Categorize by importance level
      * Focus on material impacts

    - Priority Classification
      * High: Direct financial/operational impact
      * Medium: Strategic/long-term significance
      * Low: General updates/market commentary
      * Track changes in classification over time

    - Data Presentation
      * Lead with key metrics/numbers
      * Provide clear source attribution
      * Highlight year-over-year changes
      * Include relevant context

14. 新聞分析最佳實踐（Added 2025/01）
    - 數據驅動原則
      * 每個結論都需要具體數據支持
      * 設定可量化的觀察指標
      * 建立預測與驗證機制
      * 定期回顧預測準確度

    - 分析層次
      * 第一層：直接相關數據與事實
      * 第二層：產業鏈影響與關聯
      * 第三層：總體環境與長期趨勢
      * 各層次間需有明確的邏輯關聯

    - 戰略洞察
      * 基於數據提出合理推論
      * 建立清晰的因果關係
      * 提供可執行的觀察指標
      * 設定具體的目標值

    - 報告架構
      * 核心數據陳述
      * 戰略意涵分析
      * 量化預測與目標
      * 風險監控指標
      * 明確引用來源

11. 新聞分析最佳實踐 (Updated 2025/01)
    - 時效性驗證
      * 嚴格區分新聞發布時間
      * 特別注意財報數據的時間點
      * 追蹤事件發展的完整時間線
      * 避免混用不同時期的數據

    - 多維度交叉驗證
      * 結合公司公告與媒體報導
      * 對照產業研究機構數據
      * 比較不同分析師觀點
      * 驗證數據一致性

    - 重大事件追蹤
      * 建立事件完整脈絡
      * 關注後續發展影響
      * 評估對公司治理的影響
      * 監控市場反應

    - 市場預測整合
      * 區分短期與長期預測
      * 注意預測的前提假設
      * 追蹤預測準確度
      * 定期更新預測數據

12. 產業分析框架 (Added 2025/01)
    - 終端市場分類
      * 企業級市場：AI伺服器、資料中心
      * 消費性市場：PC、手機、遊戲機
      * 新興市場：AI PC、車用電子
      * 分別追蹤各市場動態

    - 技術發展追蹤
      * 製程技術進展
      * 效能指標演進
      * 新應用技術發展
      * 與競品技術比較

    - 供需結構變化
      * 分析供給端產能變化
      * 追蹤需求端庫存水位
      * 觀察價格變動趨勢
      * 評估供需平衡時點

# Scratchpad

Current Task: Daily Stock News Analysis & Impact Assessment
Progress:
[X] Updated task focus to daily stock-specific news analysis
[X] Defined importance assessment criteria based on analysis framework
[ ] Optimize news collection workflow
[ ] Refine impact assessment process

Key Steps:
1. News Collection
   - Search for all news related to the target stock on the current day
   - Include both company-specific and industry-related news
   - Gather from multiple sources for cross-validation

2. Importance Assessment Criteria:
   a) Revenue Impact
      - Direct impact on revenue/profit
      - Changes in market share
      - Customer/order changes

   b) Industry Position
      - Supply chain dynamics
      - Competitive landscape changes
      - Technology/product roadmap

   c) Strategic Value
      - Long-term growth potential
      - Business model evolution
      - Market expansion opportunities

   d) Risk Factors
      - Operational challenges
      - Market uncertainties
      - Regulatory concerns

3. Framework-based Analysis:
   - Map each news item to relevant framework components
   - Assess immediate vs long-term impact
   - Consider cumulative effects with previous developments

4. Priority Levels:
   High: Direct material impact on operations/financials
   Medium: Indirect or longer-term strategic impact
   Low: General information or minor updates

Next Steps:
- [ ] Develop news categorization system
- [ ] Create impact assessment templates
- [ ] Establish priority scoring mechanism
- [ ] Design daily report format

Note: Focus on actionable insights and material impacts when assessing news importance.

# Stock Analysis Workflow (Added 2025/01)
1. Initial News Collection
   - Search for all news related to the target stock
   - Focus on last 3-6 months of news
   - Include both company-specific and industry news
   - Collect from multiple reliable sources

2. Multi-layer Analysis Framework
   第一層：直接資訊
   - 財務數據變化
   - 營運表現
   - 公司公告
   - 股價走勢

   第二層：產業鏈分析
   - 上游供應商狀況
   - 下游客戶動態
   - 競爭對手動向
   - 產業政策變化

   第三層：總體環境
   - 總體經濟影響
   - 科技發展趨勢
   - 地緣政治因素
   - 長期產業變遷

3. Cross-reference Analysis
   - 驗證不同消息來源
   - 比對歷史數據
   - 確認產業鏈關聯性
   - 評估消息可信度

4. Impact Assessment
   - 短期（1-3個月）影響
   - 中期（3-12個月）影響
   - 長期（1年以上）影響
   - 風險因素評估

5. Documentation Format
   - 時間順序紀錄
   - 重要性分類
   - 關聯性分析
   - 影響力評估

# Current Task Scratchpad
Task: 深入分析大立光相關新聞與產業動態
Progress:
[X] 完成基本新聞搜集與時間排序
[ ] 進行第二層分析：
    - 檢視蘋果、三星等客戶的新產品計畫
    - 分析人形機器人市場潛力
    - 評估超薄手機技術發展
[ ] 進行第三層分析：
    - AI視覺應用趨勢
    - 手機產業創新方向
    - 全球科技供應鏈變化
[ ] 更新投資建議

Next Steps:
1. 搜尋主要客戶（蘋果、三星）的產品規劃新聞
2. 研究人形機器人市場發展報導
3. 分析光學技術在AI時代的應用前景
4. 評估產業供應鏈變化對公司的影響
